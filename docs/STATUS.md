# STATUS.md

## 1. 最終更新

- 2026-02-23
- 更新者: AI

## 2. 現在の真実（Project Truth）

- プロジェクトは MVP 定義を完了した。
- `!ping` 依存を廃止し、チャンネル制限 + メンション必須返信フローへ移行済み。
- 通常投稿は AI 判定層（現状は Stub 実装）を経由して返信可否を決定する。
- Discord の履歴は AI 呼び出し時に都度取得する実装へ移行済み。
- AI の追加履歴要求に応じる tool use ループを実装済み。
- `CODEX_WORKSPACE_DIR` / `APOLOGY_TEMPLATE_PATH` の起動時検証を実装済み。
- 謝罪定型文は Codex ワークスペース内ドキュメントから読み出す実装へ移行済み。
- 改善提案は Codex ワークスペース配下 markdown のみ更新可能に制限済み。
- 受信ハンドラをモジュール化し、Discord API モック + AI モックの結合テストを追加済み。
- `typecheck` / `lint` / `format:check` / `test` / `build` が通る状態を確認済み。
- 今後の正しい方向は「雑談参加 Bot」への移行。
- 本体コードと Codex ワークスペース（自己改善対象）を分離する方針が確定した。

## 3. 確定済み方針

1. 人格名は「ルナ」。
2. 口調は敬語とため口を混在し、優しい少女トーンを維持する。
3. 対象チャンネル限定で動作する。
4. メンション時は必ず返信する。
5. 通常投稿への返信は AI 判断とする。
6. 会話ログ本文は永続保存しない。
7. 文脈は Discord から都度取得する。
8. 追加履歴取得（tool use）は無制限。
9. 自己改善はドキュメントのみ更新し、コードは更新しない。
10. `STATUS.md` は作業ごとに AI が更新する。

## 4. 直近タスク

1. Codex CLI app-server 実運用コマンドとの接続確認を行う。
2. 会話プロンプトテンプレートを実運用向けに調整する。
3. 履歴取得遅延の観測ログを運用で確認する。
4. 実環境で返信頻度のチューニングを行う。
5. Bot トークンを設定したローカル常駐運用で実地検証する。

## 5. ブロッカー

- なし。

## 6. リスクメモ

1. 履歴追加取得が無制限のため、遅延増加の可能性がある。
2. ログ非永続のため、長期記憶は人格ドキュメント運用に依存する。
3. 自己改善が過剰更新にならないよう、対象ディレクトリ制約が重要。

## 7. 再開時コンテキスト

再開時は以下の順で確認する。

1. `SPEC.md`
2. `PLAN.md`
3. `ARCHITECTURE.md`
4. `RUNBOOK.md`
5. 本ファイル `STATUS.md`

## 8. 実行メモ

- 正規実行環境はローカル常駐。
- VPS / コンテナは将来オプション。
- トークンなど秘密情報は常にマスクする。
- テストランナーは `vitest` を使用する。
